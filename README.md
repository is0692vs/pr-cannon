# PR Cannon üí£

> Fire your files to any repository as a Pull Request

A CLI tool that automatically creates Pull Requests by sending files to any GitHub repository. Simply specify a file and target repository, and pr-cannon handles everything: branch creation, commits, and PR generation.

[![npm version](https://badge.fury.io/js/pr-cannon.svg)](https://www.npmjs.com/package/pr-cannon)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## ‚ú® Features

- üöÄ **Fully Automated**: File reading ‚Üí Branch creation ‚Üí Commit ‚Üí PR creation
- üìÅ **Folder Support**: Send entire directories with multiple files (Issue #7)
- üóÇÔ∏è **Directory Structure Preservation**: Maintains folder hierarchy in target repository
- üìÑ **Flexible Path Control**: Custom destination paths with `--path` option
- üß™ **Test Command**: `prca test` for quick testing from current directory
- üîí **Secure**: Uses GitHub Personal Access Token
- üéØ **Simple CLI**: Intuitive command-line interface
- üì¶ **Multiple File Types**: Supports Markdown, JavaScript, JSON, text files, etc.
- üåø **Unique Branches**: Timestamp-based branch names prevent conflicts
- ‚ö° **Fast**: Creates PRs in seconds

## üì¶ Installation

```bash
npm install -g pr-cannon
```

## üîß Setup

### 1. Create GitHub Personal Access Token

1. Go to GitHub Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)
2. Click "Generate new token (classic)"
3. Select scopes:
   - ‚úÖ `repo` (Full control of private repositories)
4. Generate and copy your token

### 2. Set Environment Variable

**macOS/Linux:**

```bash
# Add to ~/.zshrc or ~/.bashrc
export GITHUB_TOKEN="ghp_your_token_here"

# Apply changes
source ~/.zshrc  # or source ~/.bashrc
```

**Windows (PowerShell):**

```powershell
$env:GITHUB_TOKEN="ghp_your_token_here"
```

**Windows (Command Prompt):**

```cmd
set GITHUB_TOKEN=ghp_your_token_here
```

## üöÄ Usage

### Basic Usage

```bash
pr-cannon fire <file-or-folder> [file-or-folder...] <owner/repo>
```

You can also use the short alias `prca`:

```bash
prca fire <file-or-folder> [file-or-folder...] <owner/repo>
```

### Examples

**Send a single file to repository:**

```bash
pr-cannon fire README.md is0692vs/pr-cannon
```

Or use the shorter command:

```bash
prca fire README.md is0692vs/pr-cannon
```

**Send multiple files in a single PR (Issue #8):**

```bash
pr-cannon fire README.md config.json LICENSE is0692vs/pr-cannon
```

This creates a single PR with all three files.

**Send multiple folders in a single PR:**

```bash
pr-cannon fire ./src ./tests ./docs is0692vs/project
```

All files from all folders will be included in one PR while maintaining directory structure.

**Mix files and folders in a single PR:**

```bash
pr-cannon fire README.md ./src LICENSE ./docs is0692vs/project
```

Combines individual files and entire directories into one PR.

**Send an entire folder to repository:**

```bash
pr-cannon fire ./src is0692vs/project --path uploaded/src
```

This will recursively send all files from `./src` directory while maintaining the folder structure.

**Specify custom destination path for file:**

```bash
pr-cannon fire config.js is0692vs/project --path src/config.js
```

**Send file to nested directory:**

```bash
pr-cannon fire guide.md is0692vs/docs --path docs/guides/setup.md
```

**Send from subdirectory:**

```bash
pr-cannon fire ./examples/sample.txt is0692vs/showcase
```

**Multiple files with custom paths:**

```bash
pr-cannon fire config.json types.ts utils.ts is0692vs/project --path src/
```

All files will be placed in the `src/` directory maintaining their original filenames.

### Test Mode

Create a test PR from the current directory with automatic timestamp-based paths:

```bash
pr-cannon test <repo>
```

Or use the short alias:

```bash
prca test is0692vs/test-pr-cannon
```

This command:

- üìç Collects all files from the current directory
- ‚è∞ Creates an automatic destination path with timestamp
- üß™ Perfect for testing the folder sending feature

### Command Reference

**Fire Command:**

```
pr-cannon fire [options] <file-or-folder> [file-or-folder...] <repo>

Arguments:
  file-or-folder     One or more file or folder paths to send
  repo               Repository in owner/repo format

Options:
  -p, --path <path>  Destination path in the repository
  -m, --auto-merge   Automatically merge PR if no conflicts and you are the repo owner
  -k, --keep-branch  Keep the branch after auto-merging (by default, branch is deleted after merge)
  -h, --help         Display help for command
```

**Batch Multiple Files/Folders:**

You can specify multiple files and/or folders to send them all in a single PR:

```bash
# Multiple files
pr-cannon fire file1.md file2.md config.json owner/repo

# Multiple folders
pr-cannon fire ./src ./tests ./docs owner/repo

# Mix files and folders
pr-cannon fire README.md ./src ./docs LICENSE owner/repo

# With custom path
pr-cannon fire config.md utils.js ./helpers owner/repo --path src/
```

All items will be combined into a single Pull Request.

### Auto-merge (for your own repositories)

```bash
# Automatically merge after PR creation
prca fire config.json is0692vs/my-repo --auto-merge

# Short version
prca fire config.json is0692vs/my-repo -m

# Works with multiple files too
prca fire file1.js file2.js is0692vs/my-repo -m

# Keep branch after auto-merge
prca fire config.json is0692vs/my-repo -m -k
```

**Note:** Auto-merge only works if:

- You are the owner of the target repository
- There are no merge conflicts
- All required checks pass

By default, the branch is automatically deleted after merging (following GitHub's standard workflow).
If you want to keep the branch, use the `--keep-branch` / `-k` flag.

**Test Command:**

```
pr-cannon test [options] <repo>

Arguments:
  repo               Repository in owner/repo format

Options:
  -p, --path <path>  Custom destination path (optional)
  -h, --help         Display help for command
```

## üìñ How It Works

### File Sending

1. **Reads** your local file and encodes it
2. **Connects** to GitHub API using your token
3. **Creates** a new branch with unique timestamp
4. **Commits** the file to the new branch
5. **Opens** a Pull Request automatically
6. **Displays** PR URL in your terminal

### Folder Sending (Issue #7) & Multiple Files/Folders (Issue #8)

1. **Detects** if input is a file or directory
2. **Recursively collects** all files from directories while:
   - Excluding `.git`, `node_modules`, `.DS_Store`, and hidden files
   - Preserving directory structure with relative paths
3. **Reads** all files and encodes them
4. **Combines multiple inputs** into a single file list when multiple paths are specified
5. **Connects** to GitHub API using your token
6. **Creates** a new branch with unique timestamp
7. **Commits** all files in a single commit (preserves structure)
8. **Opens** a Pull Request automatically
9. **Displays** PR URL and summary in your terminal

## üéØ Use Cases

- **Quick file sharing** between repositories
- **Template distribution** to multiple projects
- **Configuration updates** across repositories
- **Documentation synchronization**
- **Code snippet sharing**
- **Bulk folder deployment** across projects
- **Multi-file library distribution**

## üõ†Ô∏è Development

```bash
# Clone repository
git clone https://github.com/is0692vs/pr-cannon.git
cd pr-cannon

# Install dependencies
npm install

# Build
npm run build

# Run locally
node dist/index.mjs fire <file> <repo>
```

## üß™ Testing

The project includes a comprehensive test suite for the folder sending feature (Issue #7).

### Quick Test Verification

```bash
# Verify test structure and files
./tests/verify.sh
```

### Run Full Test Suite

Prerequisites:

- `gh` (GitHub CLI): https://cli.github.com/
- `GITHUB_TOKEN` environment variable set

```bash
# Run tests against a test repository
./tests/run-tests.sh is0692vs/test-pr-cannon

# Then cleanup test PRs
./tests/cleanup.sh is0692vs/test-pr-cannon
```

**What gets tested:**

- ‚úÖ Single file sending
- ‚úÖ Folder/directory sending with multiple files
- ‚úÖ Directory structure preservation
- ‚úÖ File exclusion patterns (.git, node_modules, hidden files)
- ‚úÖ Edge cases (deeply nested directories, special characters)

For detailed testing documentation, see [TESTING.md](TESTING.md) and [tests/README.md](tests/README.md).

## üìù Examples

### Real-world Scenarios

**1. Share single configuration file across projects:**

```bash
pr-cannon fire .eslintrc.json team/project-a --path .eslintrc.json
pr-cannon fire .eslintrc.json team/project-b --path .eslintrc.json
```

**2. Send entire source folder to another repository:**

```bash
pr-cannon fire ./src team/shared-lib --path lib/source
```

This sends all files under `./src` directory while maintaining the structure.

**3. Distribute documentation folder:**

```bash
pr-cannon fire ./docs company/knowledge-base --path markdown/guides
```

**4. Share project templates:**

```bash
pr-cannon fire ./templates/react-app showcase/templates --path templates/react
```

**5. Send configuration directory:**

```bash
pr-cannon fire ./config team/project --path config
```

**6. Send multiple template files in one PR (Issue #8):**

```bash
pr-cannon fire ./templates/react ./templates/vue ./templates/svelte showcase/all-templates
```

**7. Setup complete project structure in one PR:**

```bash
pr-cannon fire ./src ./tests ./docs README.md LICENSE new-project/repo
```

This sends all source code, tests, documentation, and metadata files in a single PR.

## ‚ö†Ô∏è Troubleshooting

### "GitHub token not found" error

Make sure `GITHUB_TOKEN` environment variable is set:

```bash
echo $GITHUB_TOKEN  # Should display your token
```

### "Authentication failed" error

Your token may be expired or invalid. Generate a new token with `repo` scope.

### "Repository not found" error

- Verify the repository exists
- Check you have access to the repository
- Ensure format is correct: `owner/repo`

### "File not found" error

- Verify the file path is correct
- Use absolute or relative paths
- Check file permissions

## üìÑ License

MIT License - see [LICENSE](LICENSE) file for details

## üë§ Author

**Hiroki Mukai**

- GitHub: [@is0692vs](https://github.com/is0692vs)

## üôè Acknowledgments

Built with:

- [Commander.js](https://github.com/tj/commander.js/) - CLI framework
- [Octokit](https://github.com/octokit/octokit.js) - GitHub API client
- [TypeScript](https://www.typescriptlang.org/) - Type safety

---

## üáØüáµ Êó•Êú¨Ë™û„Éâ„Ç≠„É•„É°„É≥„Éà

### Ê¶ÇË¶Å

pr-cannon „ÅØ„ÄÅ„Éï„Ç°„Ç§„É´„Çí‰ªªÊÑè„ÅÆ GitHub „É™„Éù„Ç∏„Éà„É™„Å´ÈÄÅ‰ø°„Åó„ÄÅËá™ÂãïÁöÑ„Å´ Pull Request „Çí‰ΩúÊàê„Åô„Çã CLI „ÉÑ„Éº„É´„Åß„Åô„ÄÇ

### „Ç§„É≥„Çπ„Éà„Éº„É´

```bash
npm install -g pr-cannon
```

### „Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó

1. **GitHub „Éà„Éº„ÇØ„É≥„ÅÆ‰ΩúÊàê**

   - GitHub Settings ‚Üí Developer settings ‚Üí Personal access tokens
   - "Generate new token (classic)" „Çí„ÇØ„É™„ÉÉ„ÇØ
   - `repo` „Çπ„Ç≥„Éº„Éó„ÇíÈÅ∏Êäû
   - „Éà„Éº„ÇØ„É≥„Çí„Ç≥„Éî„Éº

2. **Áí∞Â¢ÉÂ§âÊï∞„ÅÆË®≠ÂÆö**

```bash
# ~/.zshrc „Åæ„Åü„ÅØ ~/.bashrc „Å´ËøΩÂä†
export GITHUB_TOKEN="ghp_your_token_here"

# Â§âÊõ¥„ÇíÈÅ©Áî®
source ~/.zshrc
```

### ‰Ωø„ÅÑÊñπ

**Âü∫Êú¨ÁöÑ„Å™‰Ωø„ÅÑÊñπ:**

```bash
pr-cannon fire <„Éï„Ç°„Ç§„É´„Åæ„Åü„ÅØ„Éï„Ç©„É´„ÉÄ> [„Éï„Ç°„Ç§„É´„Åæ„Åü„ÅØ„Éï„Ç©„É´„ÉÄ...] <owner/repo>
```

Áü≠Á∏Æ„Ç≥„Éû„É≥„Éâ `prca` „ÇÇ‰ΩøÁî®„Åß„Åç„Åæ„Åô:

```bash
prca fire <„Éï„Ç°„Ç§„É´„Åæ„Åü„ÅØ„Éï„Ç©„É´„ÉÄ> [„Éï„Ç°„Ç§„É´„Åæ„Åü„ÅØ„Éï„Ç©„É´„ÉÄ...] <owner/repo>
```

**‰æã: is0692vs/pr-cannon „É™„Éù„Ç∏„Éà„É™„Å´„Éï„Ç°„Ç§„É´„ÇíÈÄÅ‰ø°**

```bash
pr-cannon fire README.md is0692vs/pr-cannon
```

„Åæ„Åü„ÅØÁü≠„ÅÑ„Ç≥„Éû„É≥„Éâ„Åß:

```bash
prca fire README.md is0692vs/pr-cannon
```

**Ë§áÊï∞„Éï„Ç°„Ç§„É´„Çí 1 „Å§„ÅÆ PR „ÅßÈÄÅ‰ø°ÔºàIssue #8Ôºâ:**

```bash
pr-cannon fire README.md config.json LICENSE is0692vs/pr-cannon
```

3 „Å§„ÅÆ„Éï„Ç°„Ç§„É´„Åô„Åπ„Å¶„Åå 1 „Å§„ÅÆ PR „Å´Âê´„Åæ„Çå„Åæ„Åô„ÄÇ

**Ë§áÊï∞„Éï„Ç©„É´„ÉÄ„Çí 1 „Å§„ÅÆ PR „ÅßÈÄÅ‰ø°:**

```bash
pr-cannon fire ./src ./tests ./docs is0692vs/project
```

„Åô„Åπ„Å¶„ÅÆ„Éï„Ç©„É´„ÉÄÂÜÖ„ÅÆ„Åô„Åπ„Å¶„ÅÆ„Éï„Ç°„Ç§„É´„Åå 1 „Å§„ÅÆ PR „Å´Âê´„Åæ„Çå„ÄÅ„Éá„Ç£„É¨„ÇØ„Éà„É™ÊßãÈÄ†„Åå‰øùÊåÅ„Åï„Çå„Åæ„Åô„ÄÇ

**„Éï„Ç°„Ç§„É´„Å®„Éï„Ç©„É´„ÉÄ„ÇíÊ∑∑Âú®„Åó„Å¶ 1 „Å§„ÅÆ PR „ÅßÈÄÅ‰ø°:**

```bash
pr-cannon fire README.md ./src LICENSE ./docs is0692vs/project
```

ÂÄãÂà•„Éï„Ç°„Ç§„É´„Å®ÂÖ®‰Ωì„Éá„Ç£„É¨„ÇØ„Éà„É™„Åå 1 „Å§„ÅÆ PR „Å´Áµ±Âêà„Åï„Çå„Åæ„Åô„ÄÇ

**„Éï„Ç©„É´„ÉÄÂÖ®‰Ωì„ÇíÈÄÅ‰ø°:**

```bash
pr-cannon fire ./src is0692vs/project --path uploaded/src
```

`./src` „Éá„Ç£„É¨„ÇØ„Éà„É™ÂÜÖ„ÅÆ„Åô„Åπ„Å¶„ÅÆ„Éï„Ç°„Ç§„É´„Çí„Éï„Ç©„É´„ÉÄÊßãÈÄ†„Çí‰øùÊåÅ„Åó„Å™„Åå„ÇâÈÄÅ‰ø°„Åó„Åæ„Åô„ÄÇ

**„Ç´„Çπ„Çø„É†„Éë„ÇπÊåáÂÆö:**

```bash
pr-cannon fire config.js is0692vs/myproject --path src/config.js
```

**„Éç„Çπ„Éà„Åï„Çå„Åü„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´ÈÄÅ‰ø°:**

```bash
pr-cannon fire guide.md is0692vs/docs --path docs/guides/setup.md
```

### Ëá™Âãï„Éû„Éº„Ç∏ÔºàËá™ÂàÜ„ÅÆ„É™„Éù„Ç∏„Éà„É™„ÅÆÂ†¥ÂêàÔºâ

```bash
# PR‰ΩúÊàêÂæå„Å´Ëá™Âãï„Éû„Éº„Ç∏
prca fire config.json is0692vs/my-repo --auto-merge

# Áü≠Á∏ÆÁâà
prca fire config.json is0692vs/my-repo -m

# Ë§áÊï∞„Éï„Ç°„Ç§„É´„Åß„ÇÇ‰ΩøÁî®ÂèØËÉΩ
prca fire file1.js file2.js is0692vs/my-repo -m

# „Éû„Éº„Ç∏Âæå„Å´„Éñ„É©„É≥„ÉÅ„ÇíÊÆã„Åô
prca fire config.json is0692vs/my-repo -m -k
```

**Ê≥®ÊÑè:** Ëá™Âãï„Éû„Éº„Ç∏„ÅØ‰ª•‰∏ã„ÅÆÊù°‰ª∂„ÇíÊ∫Ä„Åü„ÅôÂ†¥Âêà„ÅÆ„ÅøÂãï‰Ωú„Åó„Åæ„ÅôÔºö

- ÂØæË±°„É™„Éù„Ç∏„Éà„É™„ÅÆ„Ç™„Éº„Éä„Éº„Åß„ÅÇ„Çã
- „Éû„Éº„Ç∏„Ç≥„É≥„Éï„É™„ÇØ„Éà„Åå„Å™„ÅÑ
- „Åô„Åπ„Å¶„ÅÆÂøÖÈ†à„ÉÅ„Çß„ÉÉ„ÇØ„ÅåÈÄöÈÅé„Åó„Å¶„ÅÑ„Çã

„Éá„Éï„Ç©„É´„Éà„Åß„ÅØÔºå„Éû„Éº„Ç∏Âæå„Å´„Éñ„É©„É≥„ÉÅ„ÅåËá™ÂãïÂâäÈô§„Åï„Çå„Åæ„ÅôÔºàGitHub „ÅÆÊ®ôÊ∫ñÁöÑ„Å™„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÔºâÔºé
„Éñ„É©„É≥„ÉÅ„ÇíÊÆã„Åó„Åü„ÅÑÂ†¥Âêà„ÅØÔºå`--keep-branch` / `-k` „Éï„É©„Ç∞„Çí‰ΩøÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºé

**„ÉÜ„Çπ„Éà„É¢„Éº„ÉâÔºàÁèæÂú®„ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™„Åã„Çâ PR „Çí‰ΩúÊàêÔºâ:**

```bash
prca test is0692vs/test-pr-cannon
```

„Åì„ÅÆ„Ç≥„Éû„É≥„Éâ„ÅßÔºö

- üìç „Ç´„É¨„É≥„Éà„Éá„Ç£„É¨„ÇØ„Éà„É™„ÅÆ„Åô„Åπ„Å¶„ÅÆ„Éï„Ç°„Ç§„É´„ÇíÂèéÈõÜ
- ‚è∞ „Çø„Ç§„É†„Çπ„Çø„É≥„Éó„Éô„Éº„Çπ„ÅÆËá™ÂãïÈÄÅ‰ø°ÂÖà„Éë„Çπ„Çí‰ΩúÊàê
- üß™ „Éï„Ç©„É´„ÉÄÈÄÅ‰ø°Ê©üËÉΩ„ÅÆ„ÉÜ„Çπ„Éà„Å´ÊúÄÈÅ©

### ‰∏ª„Å™Ê©üËÉΩ

- ‚úÖ „Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„Åø ‚Üí „Éñ„É©„É≥„ÉÅ‰ΩúÊàê ‚Üí „Ç≥„Éü„ÉÉ„Éà ‚Üí PR ‰ΩúÊàê„ÇíÂÖ®Ëá™ÂãïÂåñ
- ‚úÖ `--path`„Ç™„Éó„Ç∑„Éß„É≥„ÅßÈÄÅ‰ø°ÂÖà„Éë„Çπ„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫
- ‚úÖ `--auto-merge` / `-m` „Ç™„Éó„Ç∑„Éß„É≥„Åß PR ‰ΩúÊàêÂæå„Å´Ëá™Âãï„Éû„Éº„Ç∏ÔºàËá™ÂàÜ„ÅÆ„É™„Éù„Ç∏„Éà„É™„ÅÆ„ÅøÔºâ
- ‚úÖ „Çø„Ç§„É†„Çπ„Çø„É≥„Éó‰ªò„Åç„Éñ„É©„É≥„ÉÅÂêç„ÅßÈáçË§á„ÇíÈò≤Ê≠¢
- ‚úÖ ÊòéÁ¢∫„Å™„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏

### „Ç™„Éó„Ç∑„Éß„É≥

- `--path <path>` / `-p`: „É™„Éù„Ç∏„Éà„É™ÂÜÖ„ÅÆÈÄÅ‰ø°ÂÖà„Éë„Çπ„ÇíÊåáÂÆö
- `--auto-merge` / `-m`: „É™„Éù„Ç∏„Éà„É™„ÅÆ„Ç™„Éº„Éä„Éº„Åß„ÅÇ„Çä„Ç≥„É≥„Éï„É™„ÇØ„Éà„Åå„Å™„ÅÑÂ†¥ÂêàÔºåPR ‰ΩúÊàêÂæå„Å´Ëá™ÂãïÁöÑ„Å´„Éû„Éº„Ç∏„Åó„Åæ„Åô
- `--keep-branch` / `-k`: Ëá™Âãï„Éû„Éº„Ç∏Âæå„Å´„Éñ„É©„É≥„ÉÅ„ÇíÊÆã„Åó„Åæ„ÅôÔºà„Éá„Éï„Ç©„É´„Éà„Åß„ÅØ„Éû„Éº„Ç∏Âæå„Å´„Éñ„É©„É≥„ÉÅÂâäÈô§Ôºâ

### „Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞

**"GitHub token not found"„Ç®„É©„Éº:**

```bash
echo $GITHUB_TOKEN  # „Éà„Éº„ÇØ„É≥„ÅåË°®Á§∫„Åï„Çå„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
```

**"Authentication failed"„Ç®„É©„Éº:**

- „Éà„Éº„ÇØ„É≥„ÅåÊúüÈôêÂàá„Çå„ÅÆÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô
- `repo`„Çπ„Ç≥„Éº„Éó„ÇíÂê´„ÇÄÊñ∞„Åó„ÅÑ„Éà„Éº„ÇØ„É≥„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ

### „É©„Ç§„Çª„É≥„Çπ

MIT License

---

Made with üí£ by [is0692vs](https://github.com/is0692vs)
