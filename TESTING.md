# Testing and Cleanup Guide

## Test Organization

Test files and scripts are located in the `/tests` directory:

```
tests/
â”œâ”€â”€ README.md                    # Test documentation
â”œâ”€â”€ run-tests.sh                 # Automated test execution script
â”œâ”€â”€ cleanup.sh                   # Automated cleanup script for test PRs
â”œâ”€â”€ pr-numbers.txt              # (Generated) PR numbers created by tests
â”œâ”€â”€ single-file/                # Single file sending tests
â”‚   â””â”€â”€ sample.md
â”œâ”€â”€ folder-structure/           # Folder structure tests
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ utils.js
â”‚   â”œâ”€â”€ config.json
â”‚   â””â”€â”€ README.md
â””â”€â”€ edge-cases/                 # Edge case tests
    â”œâ”€â”€ deeply/
    â”‚   â””â”€â”€ nested/
    â”‚       â””â”€â”€ structure/
    â”‚           â””â”€â”€ file.txt
    â”œâ”€â”€ special-chars.txt
    â”œâ”€â”€ empty/
    â””â”€â”€ README.md
```

## Running Tests

### Step 1: Prerequisites

```bash
# Install pr-cannon globally
npm install -g pr-cannon

# Set GitHub token
export GITHUB_TOKEN="ghp_your_token_here"

# Install GitHub CLI
# macOS: brew install gh
# Linux: Follow https://cli.github.com/
# Windows: Follow https://cli.github.com/
```

### Step 2: Run Tests

```bash
# Run against test repository
./tests/run-tests.sh is0692vs/test-pr-cannon

# Or use default: is0692vs/test-pr-cannon
./tests/run-tests.sh
```

**Output Example:**

```
ğŸ§ª PR Cannon Folder Sending Feature Test

Repository: is0692vs/test-pr-cannon
Test Directory: /path/to/tests

ğŸ“ Test 1: Single File Sending
Sending: /path/to/tests/single-file/sample.md
âœ… PR #42 created

ğŸ“ Test 2: Folder Structure Sending
Sending: /path/to/tests/folder-structure
âœ… PR #43 created

ğŸ”§ Test 3: Edge Cases (Nested Structure)
Sending: /path/to/tests/edge-cases
âœ… PR #44 created

ğŸ“Š Test Summary
Total PRs created: 3
PR Numbers: 42 43 44

âœ… Tests completed!
ğŸ’¡ Run './tests/cleanup.sh' to close all test PRs
```

## Cleanup Process

### Manual Cleanup with GitHub CLI

If you need to manually close test PRs:

```bash
# Close a single PR
gh pr close 42 --repo is0692vs/test-pr-cannon --comment "âœ… Test PR - Feature working correctly"

# Close multiple PRs
for pr in 42 43 44; do
  gh pr close $pr --repo is0692vs/test-pr-cannon
done
```

### Automated Cleanup

The `cleanup.sh` script automates the entire process:

```bash
./tests/cleanup.sh is0692vs/test-pr-cannon
```

**What it does:**

1. Reads `pr-numbers.txt` (created by `run-tests.sh`)
2. For each PR:
   - Adds a comment explaining it was an automated test for Issue #7
   - Closes the PR automatically
3. Cleans up temporary files

**Output Example:**

```
ğŸ§¹ PR Cannon Test PR Cleanup

Repository: is0692vs/test-pr-cannon

Found PRs to close: 42 43 44

Closing PR #42...
âœ… PR #42 closed

Closing PR #43...
âœ… PR #43 closed

Closing PR #44...
âœ… PR #44 closed

âœ… Cleanup completed!
```

## PR Comment Template

When closing test PRs, the following comment is automatically added:

```
âœ… **Test PR Closed**

This PR was created as part of the **Issue #7: Folder/Directory Sending Feature** testing.

- **Test Type:** [Single file | Folder structure | Edge cases]
- **Feature:** Folder/Directory sending capability for pr-cannon
- **Status:** Tested and verified âœ“

This is an automated test PR and is now being closed.

---
*Generated by pr-cannon test cleanup script*
```

## Test Coverage

### Test 1: Single File Sending

- âœ… Send single `.md` file
- âœ… Verify file arrives in destination
- âœ… Check file integrity
- âœ… PR title and description correct

### Test 2: Folder Structure Sending

- âœ… Send multiple files in folder
- âœ… Preserve directory structure
- âœ… Maintain file relationships
- âœ… Correct relative paths

### Test 3: Edge Cases

- âœ… Deeply nested directories (3 levels)
- âœ… Special characters in filenames
- âœ… Empty directories (excluded)
- âœ… Hidden files (excluded)

## Troubleshooting

### "gh command not found"

Install GitHub CLI: https://cli.github.com/

### "GITHUB_TOKEN not found"

```bash
export GITHUB_TOKEN="ghp_your_token_here"
```

### "Repository not found"

- Verify repository exists
- Check you have access
- Ensure format: `owner/repo`

### "No pr-numbers.txt file found"

Run `./tests/run-tests.sh` first to create test PRs

## Continuous Integration

For automated testing in CI/CD pipelines:

```bash
#!/bin/bash
set -e

# Setup
npm install -g pr-cannon
export GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}

# Run tests
cd tests
./run-tests.sh owner/test-repo

# Wait for PRs to be created
sleep 5

# Cleanup
./cleanup.sh owner/test-repo
```

## Additional Notes

- Test PRs are created in a dedicated test repository to avoid clutter
- All test files are included in the git repository for reproducibility
- The `pr-numbers.txt` file is generated and ignored by git
- Test scripts are executable (chmod +x)
- Both bash scripts support custom repository via argument
